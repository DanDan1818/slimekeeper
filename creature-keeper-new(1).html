<!DOCTYPE html>
<!-- Version: 1769983152 -->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Creature Keeper</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body {width:100%;height:100%;overflow:hidden;touch-action:manipulation;}
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    background: #1a1a2e;
    color: #fff;
    font-size: 16px;
}

#game {
    width:100%;
    height:100vh;
    height:100dvh;
    display:flex;
    flex-direction:column;
    max-width:700px;
    margin:0 auto;
}

/* TOP BAR */
#topbar {
    background: #2d2d44;
    border-bottom: 2px solid #444;
    padding: 8px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 8px;
    flex-shrink: 0;
}

#topbar-left, #topbar-right {display:flex;align-items:center;gap:8px;flex-wrap:wrap;}

.stat-wrap {display:flex;align-items:center;gap:4px;}
.stat-icon {width:16px;height:16px;flex-shrink:0;}
.sbar-bg {width:70px;height:14px;background:rgba(0,0,0,0.4);border-radius:7px;overflow:hidden;border:1px solid rgba(255,255,255,0.2);}
.sbar-fill {height:100%;transition:width 0.3s ease;}
#happy-fill {background:#ff6b9d;}
#hunger-fill {background:#ffd700;}

#creature-name {font-weight:600;font-size:18px;padding:4px 8px;border-radius:4px;cursor:pointer;}
#creature-name:active {background:rgba(255,255,255,0.1);}

#coins-display {background:#ffd700;color:#000;padding:4px 10px;border-radius:12px;font-weight:600;font-size:14px;}
#level-badge {background:#4CAF50;color:#fff;padding:4px 10px;border-radius:12px;font-weight:600;font-size:14px;}

.top-btn {background:#5865F2;color:#fff;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;font-family:inherit;}
.top-btn:active {background:#4752C4;transform:translateY(1px);}

/* MAIN */
#main-area {flex:1;position:relative;overflow:hidden;}

.room {position:absolute;inset:0;display:none;flex-direction:column;align-items:center;justify-content:center;padding:20px;overflow-y:auto;}
.room.active {display:flex;}

#home-room {background:linear-gradient(180deg,#2a4a6b 0%,#1e3a5a 100%);}
.room-bg-fishing {background:linear-gradient(180deg,#1a3a5c 0%,#2a7aaa 100%);}
.room-bg-farm {background:linear-gradient(180deg,#4a7c4a 0%,#2d5a2d 100%);}
.room-bg-kitchen {background:linear-gradient(180deg,#d4854a 0%,#b86830 100%);}
.room-bg-shop {background:linear-gradient(180deg,#6b4c8a 0%,#4a3370 100%);}

.room-title {font-size:28px;font-weight:700;margin-bottom:20px;text-align:center;}

/* CREATURE */
#creature-display {width:150px;height:150px;position:relative;display:flex;align-items:center;justify-content:center;margin-bottom:20px;}
#creature-square {width:120px;height:120px;background:#4dd0e1;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);transition:transform 0.2s;}
#creature-square.bounce {animation:bounce 0.5s ease;}
@keyframes bounce {0%,100%{transform:translateY(0);}50%{transform:translateY(-15px);}}

#action-buttons {display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
.action-btn {background:#ff6b9d;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:15px;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,0.2);font-family:inherit;}
.action-btn:active {background:#ff4d7f;transform:translateY(1px);}
.action-btn:disabled {background:#666;cursor:not-allowed;}

/* EGG */
#egg-area {display:flex;flex-direction:column;align-items:center;gap:20px;}
#egg-square {width:100px;height:120px;background:#fff;border-radius:50% 50% 50% 50%/60% 60% 40% 40%;box-shadow:0 4px 12px rgba(0,0,0,0.3);animation:wobble 1.5s ease-in-out infinite;}
@keyframes wobble {0%,100%{transform:rotate(0);}25%{transform:rotate(-3deg);}75%{transform:rotate(3deg);}}
#hatch-progress {width:200px;height:12px;background:rgba(0,0,0,0.3);border-radius:6px;overflow:hidden;}
#hatch-fill {width:0%;height:100%;background:#ffd700;transition:width 0.2s;}
#hatch-btn {background:#ffd700;color:#000;border:none;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:16px;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.3);font-family:inherit;}
#hatch-btn:active {background:#ffed4e;transform:translateY(1px);}

/* FISHING */
#fishing-controls {display:flex;flex-direction:column;align-items:center;gap:12px;width:100%;max-width:300px;}
#fishing-btn {background:#4dd0e1;color:#000;border:none;padding:12px 40px;border-radius:8px;cursor:pointer;font-size:16px;font-weight:600;min-width:200px;font-family:inherit;user-select:none;}
#fishing-btn:active {background:#7ee0ed;transform:translateY(1px);}
#fishing-btn:disabled {background:#555;color:#aaa;cursor:not-allowed;}
#fishing-status {font-size:16px;font-weight:600;min-height:24px;text-align:center;}
#fish-skill {font-size:14px;color:rgba(255,255,255,0.8);}

/* FARM */
#farm-plots {display:flex;flex-direction:column;gap:12px;width:100%;max-width:400px;}
.farm-plot {background:#6b4226;border:2px solid #8b5e3c;border-radius:8px;padding:16px;display:flex;justify-content:space-between;align-items:center;}
.farm-plot.ready {border-color:#8bc34a;}
.plot-btn {background:#8bc34a;color:#000;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:600;font-family:inherit;}
.plot-btn:active {transform:translateY(1px);}
.plot-btn:disabled {background:#555;color:#aaa;cursor:not-allowed;}

/* SHOP */
#shop-items {display:grid;grid-template-columns:repeat(2,1fr);gap:12px;width:100%;max-width:400px;}
.shop-card {background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.2);border-radius:8px;padding:16px;text-align:center;cursor:pointer;}
.shop-card:active {background:rgba(255,255,255,0.15);transform:translateY(1px);}
.item-square {width:40px;height:40px;background:#ff6b9d;margin:0 auto 8px;border-radius:4px;}

/* BOTTOM NAV */
#bottom-nav {background:#2d2d44;border-top:2px solid #444;padding:8px;display:flex;justify-content:center;gap:8px;flex-shrink:0;}
.nav-btn {width:60px;height:60px;background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.2);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;flex-shrink:0;}
.nav-btn:active {background:rgba(255,255,255,0.2);transform:scale(0.95);}
.nav-btn.active {background:#5865F2;border-color:#5865F2;}

/* TITLE */
#title-screen {position:absolute;inset:0;z-index:200;background:linear-gradient(135deg,#2a1a2e 0%,#3d2a5c 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:30px;}
#title-screen h1 {font-size:36px;font-weight:700;text-align:center;}
#name-input {font-size:18px;padding:10px 20px;border-radius:8px;border:2px solid #666;background:rgba(255,255,255,0.1);color:#fff;text-align:center;width:240px;font-family:inherit;outline:none;}
#name-input:focus {border-color:#5865F2;}
#start-btn {background:#5865F2;color:#fff;border:none;padding:12px 40px;border-radius:8px;cursor:pointer;font-size:18px;font-weight:600;font-family:inherit;}
#start-btn:active {background:#4752C4;transform:translateY(1px);}
#start-btn:disabled {background:#333;color:#666;cursor:not-allowed;}

/* NOTIFICATIONS */
#notifications {position:absolute;top:60px;left:50%;transform:translateX(-50%);z-index:500;width:90%;max-width:300px;pointer-events:none;}
.notif {background:rgba(0,0,0,0.9);border:1px solid rgba(255,255,255,0.2);border-radius:8px;padding:12px 16px;margin-bottom:8px;font-size:14px;animation:notif-in 0.3s ease;}
@keyframes notif-in {from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}
.notif.fade-out {animation:notif-out 0.3s ease forwards;}
@keyframes notif-out {from{opacity:1;}to{opacity:0;}}

/* PANEL */
.panel {position:absolute;top:0;left:0;right:0;bottom:60px;background:rgba(0,0,0,0.95);z-index:100;display:none;flex-direction:column;align-items:center;padding:20px;overflow-y:auto;}
.panel.active {display:flex;}
.panel-title {font-size:24px;font-weight:700;margin-bottom:20px;}
.panel-close {position:absolute;top:12px;right:12px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;padding:4px 8px;}
#inventory-grid {display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%;max-width:280px;}
.inv-slot {aspect-ratio:1;background:rgba(255,255,255,0.05);border:2px dashed rgba(255,255,255,0.2);border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;}
.inv-slot.filled {border-style:solid;border-color:rgba(255,255,255,0.4);}
.inv-item-square {width:40px;height:40px;background:#ff6b9d;border-radius:4px;}
.inv-count {position:absolute;bottom:4px;right:4px;background:rgba(0,0,0,0.8);padding:2px 6px;border-radius:4px;font-size:12px;font-weight:600;}
</style>
</head>
<body>
<div id="game">
<div id="notifications"></div>

<div id="title-screen">
    <h1>Creature Keeper</h1><div style="font-size:12px;color:rgba(255,255,255,0.3);margin-top:-15px;">v1769983152</div>
    <p style="font-size:14px;color:rgba(255,255,255,0.6);margin-bottom:10px;">Type a name to begin</p>
    <input id="name-input" type="text" placeholder="Name your creature" maxlength="16" autofocus>
    <button id="start-btn" disabled>Start Game</button>
</div>

<div id="topbar">
    <div id="topbar-left">
        <div id="creature-name">Creature</div>
        <div id="coins-display">0</div>
    </div>
    <div id="topbar-right">
        <div class="stat-wrap">
            <div class="stat-icon" style="background:#ff6b9d;"></div>
            <div class="sbar-bg"><div class="sbar-fill" id="happy-fill" style="width:50%"></div></div>
        </div>
        <div class="stat-wrap">
            <div class="stat-icon" style="background:#ffd700;"></div>
            <div class="sbar-bg"><div class="sbar-fill" id="hunger-fill" style="width:50%"></div></div>
        </div>
        <div id="level-badge">Lv 1</div>
        <button class="top-btn" id="inventory-btn">BAG</button>
    </div>
</div>

<div id="main-area">
    <div class="room active" id="home-room">
        <div id="egg-area">
            <div id="egg-square"></div>
            <div id="hatch-progress"><div id="hatch-fill"></div></div>
            <button id="hatch-btn">Tap to Hatch</button>
        </div>
        <div id="creature-area" style="display:none;">
            <div id="creature-display"><div id="creature-square"></div></div>
            <div id="action-buttons">
                <button class="action-btn" id="feed-btn">Feed</button>
                <button class="action-btn" id="pet-btn">Pet</button>
            </div>
        </div>
    </div>

    <div class="room room-bg-fishing" id="fishing-room">
        <div class="room-title">Fishing</div>
        <div id="fishing-controls">
            <div id="fishing-status"></div>
            <button id="fishing-btn">Start Fishing</button>
            <div id="fish-skill">Fishing Lv 1 - 0/100 XP</div>
        </div>
    </div>

    <div class="room room-bg-farm" id="farm-room">
        <div class="room-title">Farm</div>
        <div id="farm-plots"></div>
    </div>

    <div class="room room-bg-kitchen" id="kitchen-room">
        <div class="room-title">Kitchen</div>
        <div style="color:rgba(255,255,255,0.7);">Coming soon...</div>
    </div>

    <div class="room room-bg-shop" id="shop-room">
        <div class="room-title">Shop</div>
        <div id="shop-items"></div>
    </div>

    <div class="panel" id="inventory-panel">
        <button class="panel-close" id="inv-close">Ã—</button>
        <div class="panel-title">Inventory</div>
        <div id="inventory-grid"></div>
    </div>
</div>

<div id="bottom-nav">
    <div class="nav-btn active" data-room="home">HOME</div>
    <div class="nav-btn" data-room="fishing">FISH</div>
    <div class="nav-btn" data-room="farm">FARM</div>
    <div class="nav-btn" data-room="kitchen">COOK</div>
    <div class="nav-btn" data-room="shop">SHOP</div>
</div>
</div>

<script>

// Error display
window.onerror = function(msg, url, line, col, error) {
    document.body.innerHTML = '<div style="padding:20px;color:#fff;background:#000;font-family:monospace;font-size:12px;">ERROR at line ' + line + ':<br>' + msg + '<br><br>' + (error ? error.stack : '') + '</div>';
    return false;
};

'use strict';

let gs = {
    hatched: false, creatureName: '', hunger: 50, happiness: 50,
    level: 1, xp: 0, xpNext: 100, coins: 0,
    inventory: {}, inventorySlots: 6,
    skills: { fishing: { level: 1, xp: 0, xpNext: 100 } },
    farmPlots: [
        { state: 'empty', growStart: 0, growTime: 20000 },
        { state: 'empty', growStart: 0, growTime: 20000 },
        { state: 'empty', growStart: 0, growTime: 20000 }
    ],
    lastPetTime: 0, petCooldown: 180000, gameStarted: false
};

let fishState = { active: false, holding: false, startTime: 0, splooshTime: 0 };

function save() {
    try { localStorage.setItem('ck', JSON.stringify(gs)); } catch(e) {}
}

function load() {
    try {
        const data = localStorage.getItem('ck');
        if (data) {
            const saved = JSON.parse(data);
            Object.keys(saved).forEach(k => { if (k in gs) gs[k] = saved[k]; });
            gs.gameStarted = gs.hatched;
        }
    } catch(e) {}
}

function notify(text) {
    const c = document.getElementById('notifications');
    const n = document.createElement('div');
    n.className = 'notif';
    n.textContent = text;
    c.appendChild(n);
    setTimeout(() => { n.classList.add('fade-out'); setTimeout(() => n.remove(), 300); }, 2000);
}

function addItem(id, count = 1) {
    if (gs.inventory[id]) {
        gs.inventory[id] += count;
    } else {
        if (Object.keys(gs.inventory).length >= gs.inventorySlots) {
            notify('Inventory full!');
            return false;
        }
        gs.inventory[id] = count;
    }
    renderInventory();
    save();
    return true;
}

function removeItem(id, count = 1) {
    if (!gs.inventory[id] || gs.inventory[id] < count) return false;
    gs.inventory[id] -= count;
    if (gs.inventory[id] <= 0) delete gs.inventory[id];
    renderInventory();
    save();
    return true;
}

function hasItem(id, count = 1) {
    return (gs.inventory[id] || 0) >= count;
}

function renderInventory() {
    const grid = document.getElementById('inventory-grid');
    grid.innerHTML = '';
    const items = Object.keys(gs.inventory);
    for (let i = 0; i < gs.inventorySlots; i++) {
        const slot = document.createElement('div');
        slot.className = 'inv-slot';
        if (i < items.length) {
            const id = items[i];
            const count = gs.inventory[id];
            slot.classList.add('filled');
            slot.innerHTML = '<div class="inv-item-square"></div><div class="inv-count">x' + count + '</div>';
            slot.title = id;
        }
        grid.appendChild(slot);
    }
}

function updateUI() {
    document.getElementById('creature-name').textContent = gs.creatureName || 'Creature';
    document.getElementById('coins-display').textContent = gs.coins;
    document.getElementById('level-badge').textContent = 'Lv ' + gs.level;
    document.getElementById('happy-fill').style.width = gs.happiness + '%';
    document.getElementById('hunger-fill').style.width = gs.hunger + '%';
    const fsk = gs.skills.fishing;
    document.getElementById('fish-skill').textContent = 'Fishing Lv ' + fsk.level + ' - ' + fsk.xp + '/' + fsk.xpNext + ' XP';
    updatePetButton();
}

function updatePetButton() {
    const btn = document.getElementById('pet-btn');
    const elapsed = Date.now() - gs.lastPetTime;
    if (gs.lastPetTime > 0 && elapsed < gs.petCooldown) {
        const rem = Math.ceil((gs.petCooldown - elapsed) / 1000);
        btn.disabled = true;
        btn.textContent = 'Pet (' + rem + 's)';
    } else {
        btn.disabled = false;
        btn.textContent = 'Pet';
    }
}

function navigateToRoom(roomId) {
    document.querySelectorAll('.room').forEach(r => r.classList.remove('active'));
    document.getElementById(roomId + '-room').classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.room === roomId);
    });
    if (roomId === 'farm') renderFarm();
}

let hatchProgress = 0;
function setupHatch() {
    document.getElementById('hatch-btn').onclick = () => {
        hatchProgress += 10;
        document.getElementById('hatch-fill').style.width = Math.min(hatchProgress, 100) + '%';
        if (hatchProgress >= 100) {
            setTimeout(() => {
                gs.hatched = true;
                document.getElementById('egg-area').style.display = 'none';
                document.getElementById('creature-area').style.display = 'block';
                notify('Your creature has hatched!');
                save();
                updateUI();
            }, 300);
        }
    };
}

function bounce() {
    const sq = document.getElementById('creature-square');
    sq.classList.remove('bounce');
    void sq.offsetWidth;
    sq.classList.add('bounce');
}

// SIMPLIFIED FISHING - PRESS AND HOLD ONLY
function setupFishing() {
    const btn = document.getElementById('fishing-btn');
    const status = document.getElementById('fishing-status');
    
    btn.onpointerdown = (e) => {
        e.preventDefault();
        if (fishState.active) return;
        
        fishState.active = true;
        fishState.holding = true;
        fishState.startTime = Date.now();
        
        btn.textContent = 'HOLDING...';
        btn.disabled = true;
        status.textContent = 'Wait for the splash!';
        
        // Random wait 1-4 seconds
        const waitTime = 1000 + Math.random() * 3000;
        fishState.splooshTime = fishState.startTime + waitTime;
        
        checkFishing();
    };
    
    btn.onpointerup = (e) => {
        e.preventDefault();
        fishState.holding = false;
    };
    
    btn.onpointercancel = (e) => {
        e.preventDefault();
        fishState.holding = false;
    };
}

function checkFishing() {
    if (!fishState.active) return;
    
    const now = Date.now();
    const status = document.getElementById('fishing-status');
    const btn = document.getElementById('fishing-btn');
    
    // Check if sploosh happened
    if (now >= fishState.splooshTime) {
        status.textContent = 'RELEASE NOW!';
        
        // Check if user released in time (500ms window)
        if (!fishState.holding) {
            // Success!
            fishCatch();
            return;
        }
        
        // Still holding after 500ms = too late
        if (now > fishState.splooshTime + 500) {
            status.textContent = 'Too slow! Fish escaped.';
            resetFishing();
            return;
        }
    } else {
        // Still waiting for sploosh
        if (!fishState.holding) {
            // Released too early
            status.textContent = 'Released too early!';
            resetFishing();
            return;
        }
    }
    
    requestAnimationFrame(checkFishing);
}

function fishCatch() {
    const status = document.getElementById('fishing-status');
    status.textContent = 'Caught something!';
    
    const caught = Math.random() < 0.7 ? 'fish' : 'seaweed';
    addItem(caught, 1);
    
    const coinGain = caught === 'fish' ? 3 : 1;
    gs.coins += coinGain;
    
    const xpGain = caught === 'fish' ? 15 : 5;
    addSkillXP('fishing', xpGain);
    
    gs.happiness = Math.min(100, gs.happiness + 3);
    notify('Caught ' + caught + '! +' + coinGain + ' coins');
    save();
    updateUI();
    
    setTimeout(resetFishing, 1000);
}

function resetFishing() {
    fishState.active = false;
    fishState.holding = false;
    const btn = document.getElementById('fishing-btn');
    btn.disabled = false;
    btn.textContent = 'Start Fishing';
    document.getElementById('fishing-status').textContent = '';
}

function addSkillXP(skillName, amount) {
    const sk = gs.skills[skillName];
    sk.xp += amount;
    if (sk.xp >= sk.xpNext) {
        sk.xp -= sk.xpNext;
        sk.level++;
        sk.xpNext = Math.floor(sk.xpNext * 1.3);
        notify(skillName + ' leveled up to ' + sk.level + '!');
    }
    gs.xp += Math.floor(amount * 0.5);
    if (gs.xp >= gs.xpNext) {
        gs.xp -= gs.xpNext;
        gs.level++;
        gs.xpNext = Math.floor(gs.xpNext * 1.25);
        notify('Leveled up to ' + gs.level + '!');
    }
    save();
}

function renderFarm() {
    const container = document.getElementById('farm-plots');
    container.innerHTML = '';
    gs.farmPlots.forEach((plot, i) => {
        const div = document.createElement('div');
        div.className = 'farm-plot';
        let status = 'Empty';
        let btnText = 'Plant Seed';
        let btnDisabled = !hasItem('seed', 1);
        if (plot.state === 'growing') {
            const elapsed = Date.now() - plot.growStart;
            const pct = Math.floor((elapsed / plot.growTime) * 100);
            status = 'Growing... ' + Math.min(pct, 100) + '%';
            btnText = 'Wait';
            btnDisabled = true;
            if (elapsed >= plot.growTime) {
                plot.state = 'ready';
                gs.farmPlots[i] = plot;
                save();
                renderFarm();
                return;
            }
        } else if (plot.state === 'ready') {
            div.classList.add('ready');
            status = 'Ready to harvest!';
            btnText = 'Harvest';
            btnDisabled = false;
        }
        div.innerHTML = '<div><div style="font-weight:600;">Plot ' + (i + 1) + '</div><div style="font-size:14px;color:rgba(255,255,255,0.7);">' + status + '</div></div><button class="plot-btn" ' + (btnDisabled ? 'disabled' : '') + '>' + btnText + '</button>';
        const btn = div.querySelector('.plot-btn');
        btn.onclick = () => farmAction(i);
        container.appendChild(div);
    });
}

function farmAction(i) {
    const plot = gs.farmPlots[i];
    if (plot.state === 'empty') {
        if (!hasItem('seed', 1)) {
            notify('Need seeds! Buy at shop');
            return;
        }
        removeItem('seed', 1);
        gs.farmPlots[i] = { state: 'growing', growStart: Date.now(), growTime: 20000 };
        notify('Seed planted!');
        save();
        renderFarm();
    } else if (plot.state === 'ready') {
        gs.farmPlots[i] = { state: 'empty', growStart: 0, growTime: 20000 };
        addItem('carrot', 1);
        gs.coins += 2;
        notify('Harvested carrot! +2 coins');
        save();
        renderFarm();
    }
}

const SHOP_ITEMS = [
    { id: 'food', name: 'Food', price: 5 },
    { id: 'seed', name: 'Seed', price: 3 }
];

function renderShop() {
    const container = document.getElementById('shop-items');
    container.innerHTML = '';
    SHOP_ITEMS.forEach(item => {
        const card = document.createElement('div');
        card.className = 'shop-card';
        card.innerHTML = '<div class="item-square"></div><div style="font-weight:600;margin-bottom:4px;">' + item.name + '</div><div style="color:#ffd700;">' + item.price + ' coins</div>';
        card.onclick = () => {
            if (gs.coins < item.price) {
                notify('Not enough coins!');
                return;
            }
            if (!addItem(item.id, 1)) return;
            gs.coins -= item.price;
            notify('Bought ' + item.name + '!');
            save();
            updateUI();
        };
        container.appendChild(card);
    });
}

function startDecay() {
    setInterval(() => {
        if (!gs.hatched) return;
        gs.hunger = Math.max(0, gs.hunger - 0.4);
        gs.happiness = Math.max(0, gs.happiness - 0.3);
        updateUI();
        if (gs.happiness > 60) bounce();
    }, 3000);
    setInterval(() => updatePetButton(), 1000);
}

setInterval(() => {
    if (document.getElementById('farm-room').classList.contains('active')) renderFarm();
}, 1000);

function setupEvents() {
    const nameInput = document.getElementById('name-input');
    const startBtn = document.getElementById('start-btn');
    
    nameInput.addEventListener('input', () => {
        startBtn.disabled = nameInput.value.trim().length === 0;
    });
    
    nameInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !startBtn.disabled) {
            const name = nameInput.value.trim();
            if (name) {
                gs.creatureName = name;
                gs.gameStarted = true;
                document.getElementById('title-screen').style.display = 'none';
                updateUI();
                save();
            }
        }
    });
    
    startBtn.onclick = () => {
        const name = nameInput.value.trim();
        if (!name) return;
        gs.creatureName = name;
        gs.gameStarted = true;
        document.getElementById('title-screen').style.display = 'none';
        updateUI();
        save();
    };
    
    document.getElementById('feed-btn').onclick = () => {
        if (!gs.hatched) return;
        if (hasItem('food', 1)) {
            removeItem('food', 1);
            gs.hunger = Math.min(100, gs.hunger + 30);
            notify('Fed your creature!');
        } else {
            gs.hunger = Math.min(100, gs.hunger + 5);
            notify('Need food! Buy at shop');
        }
        save();
        updateUI();
        bounce();
    };
    
    document.getElementById('pet-btn').onclick = () => {
        if (!gs.hatched) return;
        const elapsed = Date.now() - gs.lastPetTime;
        if (gs.lastPetTime > 0 && elapsed < gs.petCooldown) {
            const rem = Math.ceil((gs.petCooldown - elapsed) / 1000);
            notify('Wait ' + rem + 's to pet again!');
            return;
        }
        gs.happiness = Math.min(100, gs.happiness + 8);
        gs.lastPetTime = Date.now();
        notify('Petted your creature!');
        save();
        updateUI();
        bounce();
    };
    
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.onclick = () => navigateToRoom(btn.dataset.room);
    });
    
    document.getElementById('inventory-btn').onclick = () => {
        document.getElementById('inventory-panel').classList.toggle('active');
    };
    
    document.getElementById('inv-close').onclick = () => {
        document.getElementById('inventory-panel').classList.remove('active');
    };
}

function init() {
    load();
    setupEvents();
    setupHatch();
    setupFishing();
    startDecay();
    if (gs.gameStarted) document.getElementById('title-screen').style.display = 'none';
    if (gs.hatched) {
        document.getElementById('egg-area').style.display = 'none';
        document.getElementById('creature-area').style.display = 'block';
    }
    updateUI();
    renderInventory();
    renderShop();
}


console.log('Script loaded');
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM ready');
});

init();
</script>
</body>
</html>
